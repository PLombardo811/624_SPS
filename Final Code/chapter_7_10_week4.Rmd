---
title: '7.10'
output: html_document
---



#7.10
```{r}
data(ukcars)
head(ukcars)
```
##7.10.a: Plot the data and describe the main features of the series
```{r}
autoplot(ukcars)
```
#### Answer: 
The data shows trend and seasonality (quarterly)


##7.10.b: Decompose the series using STL and obtain the seasonally adjusted data.
```{r}
decomposed <- stl(ukcars, s.window="periodic", robust=TRUE)
seasonal <- decomposed$time.series[,1]

cars_stl <- ukcars - seasonal
cars_stl
autoplot(cars_stl)
```
After decomposing the seasonally adjusted data shows smaller variability

##7.10.c: Forecast the next two years of the series using an additive damped trend method applied to the seasonally adjusted data. (This can be done in one step using stlf() with arguments etsmodel="AAN", damped=TRUE.)
```{r}
stlf_decompose_ukcars <- stlf(cars_stl, etsmodel="AAN", damped=TRUE)
stlf_decompose_ukcars
```
##7.10.d: Forecast the next two years of the series using Holt's linear method applied to the seasonally adjusted data (as before but with damped=FALSE).
```{r}


holt_model <- holt(cars_stl, etsmodel="AAN", damped=FALSE)
holt_model
summary(holt_model)
```




##7.10.e: Now use ets() to choose a seasonal model for the data. 
```{r}
ets_model <- ets(cars_stl)
summary(ets_model)
```
## 7.10.f: Compare the RMSE of the ETS model with the RMSE of the models you obtained using STL decompositions. Which gives the better in-sample fits?

accuracy of the first (STL +  ETS(A,Ad,N)) model (refer to question 7.c):
```{r}

accuracy(stlf_decompose_ukcars)


```

accuracy of the second model (refer to question 7.d):
```{r}

accuracy(holt_model)

```

accuracy of the ETS model (refer to question 7.e):

```{r}

accuracy(fit3)


```

##### Answer:
Comparing the RMSE of the models obtained using STL decompositions (stlf_decompose_ukcars and holt_model) with the RMSE of the ETS model (ets_model), the best model was "stlf_decompose_ukcars" created in 7.c (STL +  ETS(A,Ad,N)) 



##7.10.g: Compare the forecasts from the three approaches? Which seems most reasonable?


```{r}
autoplot(stlf_decompose_ukcars); autoplot(holt_model) ; autoplot(forecast(ets_model,h=8))
```

forecast of ETS model:
```{r}
forecast(ets_model,h=8)
```

#### Answer:
The forecast of the STL +  ETS(A,Ad,N) model seems reasonable. 





##7.h: Check the residuals of your preferred model
```{r}

checkresiduals(stlf_decompose_ukcars)

```

The residuals seem to still have some autocorrelation. 
